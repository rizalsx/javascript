//Ajax JSON NewsTicker by MKR
(function(a){a.NewsTicker=function(c,b){var d=this;d.$el=a(c);d.init=function(){d.options=a.extend({},a.NewsTicker.defaultOptions,b);d.$el.addClass("loading");a.get((d.options.blogURL===""?window.location.protocol+"//"+window.location.host:d.options.blogURL)+"/feeds/posts/default"+(d.options.tagName===false?"":"/-/"+d.options.tagName)+"?max-results="+d.options.MaxPost+"&orderby=published&alt=json-in-script",function(z){var C,h,o,u,D,E,w,B,q,r,m,g,y,A,p,k="",f=z.feed.entry;if(f!==undefined){var n=f.length;for(var x=0;x<n;x++){var t=f[x].link.length;for(var v=0;v<t;v++){if(f[x].link[v].rel=="alternate"){C=f[x].link[v].href}}for(var s=0;s<t;s++){if(f[x].link[s].rel=="replies"&&f[x].link[s].type=="text/html"){E=f[x].link[s].title.split(" ")[0];break}}B=("content" in f[x])?f[x].content.$t:("summary" in f[x])?f[x].summary.$t:"";var e=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi;r=a("<div></div>").append(B.replace(e,""));imgb=r.find("img");if("media$thumbnail" in f[x]){q=f[x].media$thumbnail.url}else{if(imgb.length!=0){q=imgb[0].src}else{q=d.options.pBlank}}B=B.replace(/<\S[^>]*>/g,"").replace(/"/g,"&quot;");if(B.length>d.options.Summarylength){B=B.substring(0,d.options.Summarylength)+"..."}h=f[x].title.$t;A=f[x].published.$t.substring(0,10);o=A.substring(0,4);u=A.substring(5,7);D=A.substring(8,10);w=d.options.MonthNames[parseInt(u,10)-1];m=f[x].published.$t.substring(11,16);g=m.substring(0,2);y=m.substring(2,5);if(g<12){p="AM"}else{p="PM"}if(g===0){g=12}if(g>12){g=g-12}k+='<li class="news-item"><a data-comment="'+E+'" data-date="'+w+" "+D+", "+o+" "+g+""+y+" "+p+'" data-description="'+B+'" data-image="'+q+'" data-title="'+h+'" class="title" href="'+C+'"><span title="'+w+" "+D+", "+o+'" class="date">'+g+""+y+" "+p+"</span> <span>"+h+"</span></a></li>"}d.$el.html('<ul class="js-hidden" id="newstick">'+k+"</ul>").removeClass("loading");a("#outer-wrapper").append('<div class="postinfo"/>');a("#newstick").ticker({speed:d.options.Speed,direction:a("#outer-wrapper").attr("class"),titleText:d.options.titleText,displayType:d.options.displayType});a("#content-wrapper, #header-wrapper").mouseenter(function(){a(".postinfo").filter(":not(:animated)").hide().removeClass("whitex")}).mousemove(function(){a(".postinfo").filter(":not(:animated)").hide().removeClass("whitex")});a("#newsticker .ticker-content").mouseenter(function(){var i=a(this).find("a");var H=i.attr("data-title");var G=i.attr("data-image");var l=i.attr("data-description");var j=i.attr("data-date");var F=i.attr("data-comment");a(".postinfo").html('<div class="inner"><img src="'+G+'"/><strong>'+H+'</strong><span><i class="icon-time"></i> '+j+' <i class="icon-comment"></i> '+F+"</span><p>"+l+"</p></div>");a(".postinfo").filter(":not(:animated)").fadeIn(700)}).mousemove(function(I){var H=a(window).width(),j=a(window).height(),i=a(".postinfo").outerWidth(),l=a(".postinfo").outerHeight(),G=I.pageY+10,F=I.pageX+10;if(F+i>H){F=H-i-10}a(".postinfo").css({top:G,left:F})}).mouseleave(function(){a(".postinfo").filter(":not(:animated)").hide().html("")})}else{d.$el.html("<span>No result!</span>").removeClass("loading")}},"jsonp")};d.init()};a.NewsTicker.defaultOptions={blogURL:"",MaxPost:9,Speed:0.1,titleText:"Latest",displayType:"reveal",Summarylength:150,pBlank:"http://1.bp.blogspot.com/-htG7vy9vIAA/Tp0KrMUdoWI/AAAAAAAABAU/e7XkFtErqsU/s72-c/grey.gif",tagName:false,MonthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]};a.fn.NewsTicker=function(b){return this.each(function(){(new a.NewsTicker(this,b))})}})(jQuery);